# ソフトウェア基礎特論　期末レポート課題
理工学研究科　情報科学専攻　1年55組1番（4555255001）　岡本 八仁

## 今回題材としたゲーム・パズル
[**ドンジャラ（ドラえもんDXルール）**](https://bandainamco-bcpombucket1.s3.amazonaws.com/docs/answers/url/4543112801173.pdf )<br>
基本は麻雀に近しいゲーム性だが、いくつか異なる点があるため以下に記載する。

- 牌に、番号（一萬～九萬など）の概念が存在しない
  - そのため、順子が存在しない（刻子のみ）
- チー、ポン、カンといった他人が捨てた牌を獲得するルールが存在しない
  - そのため、槓子も存在しない
- 牌の種類や数が異なる
  - （ドラえもん×9, のび太×9, しずか×9, ドラミ×9, ジャイアン×9, スネ夫×9, ひみつ道具×9, のび太のママ×3, のび太のパパ×3, セワシ×3, 出木杉×3, ジャイ子×3）
- 手牌が8個であり、毎ターン1つツモって捨てるゲーム性である
- 役が異なる（参考：https://toy.bandai.co.jp/series/donjara/item/detail/13494/）

## システム構成
今回はドンジャラのシステムをWebアプリケーション形式で実装した<br>
（使用技術：React + TypeScript）<br>
・ルールごとに牌の数/種類や役の種類をJSON形式で指定できるように設計を行った<br>
（以下は実際にドラえもんDXのルールを指定した場合のJSONファイル）
![alt text](image.png)<br>
（中略）<br>
![alt text](image-1.png)

実際のプレイ画面は以下のようになっている
![alt text](image-4.png)

## 作成したプレイヤ
今回は、以下の2種類の戦略をとるプレイヤを実装した。<br>
- 1：ランダムプレイヤ
  - 手牌（8個）+ツモ牌（1個）から完全ランダムに1個捨てる戦略
  - リーチできる場合はリーチする
- 2：手牌と役の近さを評価するプレイヤ
  - 手牌（8個）+ツモ牌（1個）すべてに対して、それを捨てた後の手牌とすべての役の組み合わせを全探索する
  - 各役に対して、「後何枚足りないか」を計算する
    - 各役に対して、（役の点数） / (足りない枚数 + 1)を求め、その合計を求める
  - 捨てた結果最も評価値が高くなるものを捨てる
  - リーチできる場合はリーチする
- 3：2の戦略に加えて、他人に放銃することを避けるプレイヤ
  - リーチしているプレイヤが存在する場合、そのプレイヤが最近捨てた牌を優先して捨てる戦略
    - 麻雀でいうところの「ベタオリ、現物を切る」イメージ
- 4：上がり優先
  - 2の戦略の評価値計算を一部変更し、役の点数を無視して最も上がりやすい手を狙う戦略
- 5：高得点優先
  - 基本は2の戦略と同じだが、すべての役ではなく点数が100,000点を超えるもののみを対象とする戦略


## 評価
ドンジャラ（ドラえもんDXルール）にのっとり、以下のようなルールで各プレイヤ（戦略）の評価を行った。
- 各プレイヤの初期持ち点は600,000点
- 親はランダムにプレイヤから選び、半荘を行う（親が2周するまで行う）
- 親が上がった場合は次のセットも同じプレイヤが親となり、そうでない場合は時計回りに親が移動する
- ロン上がりの場合は放銃したプレイヤーから役の点数を獲得し、ツモ上がりの場合は他3人から均等に1/3ずつ獲得する<br>

以上のルールでそれぞれ100半荘を行い、終了時点の持ち点の平均を調査した。

### 評価結果
#### 戦略2（役の点数と近さで評価） vs ランダム3人
- 平均最終持ち点：915,866.9点
- 1位率：97.0%
- 2位率：2.0%
- 3位率：0.0%
- 4位率：1.0%

（流局回数：335回）<br>
仕様上、リーチをするとツモ切りしかできなくなるため、ランダム戦略で上がることもあった。

#### 戦略3（戦略2+放銃回避） vs ランダム3人
- 平均最終持ち点：936,266.8点
- 1位率：92.0%
- 2位率：7.0%
- 3位率：1.0%
- 4位率：0.0%

（流局回数：323回）<br>
わずかではあるが、戦略2より平均最終持ち点が高かったり、一度も4位を取ることが無かったりという点で戦略3の効果がみられた。

#### 戦略4（最も上がりに近い役を目指す）vs ランダム3人
- 平均最終持ち点：811,033.5点
- 1位率：90.0%
- 2位率：8.0%
- 3位率：1.0%
- 4位率：1.0%

（流局回数：278回）<br>
平均最終持ち点/着順率の観点では、戦略2より劣っているように思われる。<br>
しかし、流局回数がかなり少なくなっており、上がりやすさの面では優れていると考えられる。

#### 戦略5（戦略2の100,000点以上の役しか狙わない版）vs ランダム3人
- 平均最終持ち点：911,566.9点
- 1位率：89.0%
- 2位率：9.0%
- 3位率：1.0%
- 4位率：1.0%

（流局回数：420回）<br>
平均最終持ち点や着順率の観点では他の戦略と大きな差は見られなかったが、流局回数がかなり多くなっていた。<br>
どんな配牌からでも高い役を狙ってしまうため、役を揃えられないことが多かったと思われる。

#### 付録：戦略2 vs 戦略3 vs 戦略4 vs 戦略5
- 戦略2
  - 平均最終持ち点：629,200.7(+29,200.7)点
  - 着順率：27.0-28.0-26.0-19.0(%)
- 戦略3
  - 平均最終持ち点：650034.0(+50,034.0)点
  - 着順率：36.0-29.0-23.0-12.0(%)
- 戦略4
  - 平均最終持ち点：535667.1(-64,332.9)点
  - 着順率：22.0-20.0-22.0-36.0(%)
- 戦略5
  - 平均最終持ち点：585100.7（-14.899.3）点
  - 着順率：15.0-23.0-29.0-33.0(%)

（流局回数：60回）<br>
今回のルールでは着順による素点のボーナスがないため、単純に平均最終持ち点で考えると、直接対決では<br>
**戦略3 > 戦略2 > 戦略5 > 戦略4**という強さとなった。<br>
ランダムプレイヤが存在するときと違い、流局回数がかなり減って一般的な試合に近づいたのではないかと思われる。
